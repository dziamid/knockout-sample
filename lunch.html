<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script type="text/javascript" src="vendor/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="vendor/jquery.tmpl.js"></script>
    <script type="text/javascript" src="vendor/knockout/knockout-latest.debug.js"></script>



    <style type="text/css">
        body {
            font-family: Helvetica, "Helvetica Neue";
            background-color:#528CE0;

        }
        .body {
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            padding: 20px 40px;
            margin: 40px;
        }
        .list {
            display: table-row;
        }
        .item {
            cursor: pointer;
            background: #ccc;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            margin: 5px;
            list-style: none;
        }
        .item span {
            display: table-cell;
            padding: 5px 10px;
        }

        .calendar.list {
            display: table-row;
        }
        .calendar .item {
            display: table-cell;

        }
        .item:hover,
        .item.active {
            background: black;
            color: white;
        }


    </style>
</head>
<body>
<div class="body">
    <h3>Calendar</h3>

    <ul class="calendar list" data-bind="foreach: menus">
        <li class="item" data-bind="click: $root.activateMenu, css: {active: $root.isActiveMenu($data)}">
            <span data-bind="text: title"></span>
        </li>
    </ul>

    <h3>Menu for <span data-bind="text: activeMenu().title"></span></h3>
    <ul class="menu list" data-bind="foreach: activeMenuItems">
        <li class="item" data-bind="click: $root.addToOrder">
            <span data-bind="text: title"></span>
        </li>
    </ul>

    <h3>Your order:</h3>
    <ul class="order list" data-bind="foreach: orderItems">
        <li class="item">
            <span data-bind="text: title()"></span>
            <span data-bind="text: amount()"></span>
        </li>
    </ul>

</div>

<script type="text/javascript">
    function Menu(id, title) {
        return {
            id: id,
            title: title
        };
    };

    function MenuItem(id, title, menuId) {
        return {
            id: id,
            title: title,
            menuId: menuId
        };
    };

    function OrderItem(menuItem, amount) {
        return {
            menuItem: ko.observable(menuItem),
            amount: ko.observable(amount),
            title: function () {
                return this.menuItem().title;
            },
            addOne: function () {
                return this.amount(this.amount() + 1);
            }
        };
    }

    function MenuVM(activeMenuId) {
        var self = this;

        self.menus = ko.observableArray([
            new Menu(1, 'Yesterday'),
            new Menu(2, 'Today'),
            new Menu(3, 'Tomorrow')
        ]);

        self.menuItems = ko.observableArray([
            new MenuItem(1, 'Spagetti', 1),
            new MenuItem(2, 'Makaroni', 1),
            new MenuItem(3, 'Plov', 2),
            new MenuItem(4, 'Super sup', 2),
            new MenuItem(5, 'Govno sup', 3)
        ]);

        self.findMenu = function (id) {
            return ko.utils.arrayFirst(self.menus(), function (o) {
                return id == o.id;
            });
        };
        self.findMenuItem = function (id) {
            return ko.utils.arrayFirst(self.menuItems(), function (o) {
                return id == o.id;
            });
        };
        self.findMenuItems = function (menuId) {
            return ko.utils.arrayFilter(self.menuItems(), function (item) {
                return menuId == item.menuId;
            });
        };
        self.activeMenu = ko.observable();
        self.activeMenuItems = ko.observableArray();
        self.activateMenu = function(menu) {
            self.activeMenu(menu);
            self.activeMenuItems(self.findMenuItems(menu.id));
        };
        self.isActiveMenu = function (menu) {
            return menu.id == self.activeMenu().id;
        };

        self.activateMenu(self.findMenu(activeMenuId));

        //order
        self.orderItems = ko.observableArray();
        self.addToOrder = function (menuItem) {

            var item = ko.utils.arrayFirst(self.orderItems(), function (o) {
                return menuItem.id == o.menuItem().id;
            });
            if (item) {
                item.addOne();
            } else {
                item = new OrderItem(menuItem, 1);
                self.orderItems.push(item);
            }

        };

        self.addToOrder(self.findMenuItem(1));

    };

    var viewModel = new MenuVM(2);
    ko.applyBindings(viewModel);

</script>
</body>
</html>